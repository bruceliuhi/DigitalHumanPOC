# ASR 硬件配置与协议

> 致力传感器数据协议与硬件规格说明

## 📚 参考文档

### 1. 致力传感器数据协议文档_V0（单人多模态）
- **链接**: [飞书文档](https://gxhdvps5xn.feishu.cn/wiki/EqlmwVBCSi7V0MkxUTLcFVEynob?fromScene=spaceOverview)
- **版本**: V0
- **说明**: 包含基础单人多模态数据协议定义。

### 2. 致力传感器数据协议文档_V1（单人多模态 V3.0）
- **链接**: [飞书文档](https://gxhdvps5xn.feishu.cn/wiki/LuREwS3FbiTwkIkJTiicOntjnhe?fromScene=spaceOverview)
- **版本**: V1 (对应 V3.0)
- **说明**: 更新后的数据协议文档。

---
版本
- 多模态应用版本低于3.0版本，请参考瓦力传感器数据协议文档（单人多模态）
- 本文档协议试用于多模态应用V3.0.1.6及以后版本
1. 概述
瓦力传感器作为“耳朵”和“眼睛”，实时采集并传输音频与图像数据。采用智能降噪、唇语复核等先进算法提取、提纯说话人的音频数据，确保数据精准传输。
1.1 适用场景
适用于需要提取画面中单人说话语场景的数据采集场合。
1.2 传输数据类型
暂时无法在飞书文档外展示此内容
1.3 传输协议
- 协议类型：WebSocket（TCP 长连接）
- 服务模式：支持服务端（局域网/USB）与客户端（广域网）两种部署模式。

---
2. 接入步骤
2.1 配置参数
2.1.1 配置说明
- 瓦力可作为 WebSocket 服务端或客户端使用，请根据实际场景选择相应配置。
- 默认配置适用于大多数场景，可根据需要调整配置参数。
- 重启瓦力或重新启动多模态应用后，配置生效。
2.1.2 配置步骤
- 微信搜索“万屏助理”或者微信扫码以下二维码
[图片]
- 在以下小程序页面点击“新增设备”按钮
[图片]
- 手动输入设备序列号或者扫描瓦力机身二维码或者瓦力系统桌面的二维码添加管理设备
- 根据下列图示，进入数据传输设置，具体接口模式和调用方式根据业务选择，具体含义参考下一小节。
- 如果是使用本章文档对接，协议版本=v1
[图片]

2.1.3 瓦力作为服务端
瓦力可以作为服务端，为客户端提供 1V1 稳定传输。根据实际需求，支持以下两种传输方式：
局域网传输
瓦力和客户端处于同一局域网时，数据采集和接收均在同一网络环境中完成。此模式无需额外配置。
客户端连接地址为瓦力分配的IP地址，IP可在小程序->关于本机里看到，比如瓦力IP为192.168.2.220，那么业务客户端程序连接ws://192.168.2.220:39999即可。
USB 传输
通过配置 is_usb为true，启用 USB 传输模式，WebSocket 服务端的 IP 固定为 127.0.0.1。
- 配置步骤：
USB 传输模式需要在接收客户端的 PC 环境中执行瓦力端口映射。在 PC 启动或客户端接收程序连接瓦力之前，执行：adb forward tcp:39999 tcp:39999。
- 工具依赖：
有关 adb 工具的安装和使用，请参考第 4.1 节。

---
2.1.4 瓦力作为客户端
瓦力在 客户端模式 下支持 局域网和广域网传输，数据采集和接收可在不同网络下完成。作为客户端时，接收端可同时接收多个瓦力的连接和数据传输。

---
2.2 建立连接
- 客户端作为数据接收端可配置为 WebSocket 的 Server 端或 Client 端。
- 与瓦力建立 WebSocket 连接后，必须按照标准 WebSocket 通信协议维持长连接心跳。

---
2.3 数据解析
2.3.1 数据类型说明
瓦力通过 WebSocket 传输的数据主要分为两大类：流式文本数据与二进制数据。
- 当 websocket 收到的数据类型为文本数据时，参考2.3.2章节解析。
- 当收到的数据为二进制数据时，参考2.3.3章节解析。
2.3.2 文本数据
- 数据类型：json字符串，结构如下
{
    "action":"",
    "data":""
}
- 说明： action标识文本类型，data是具体内容
2.3.2.1 ASR文本转写
{
   “action”:"asr",
   "data" : "" //json串，参考讯飞文档解析https://aiui-doc.xf-yun.com/project-1/doc-16/
}
- data里的sid字段是区分哪一句话的标识
- 流式数据格式示例：
{
    "filtered": "深圳天气怎么样",
    "speak_index": "0",
    "sid":"",
    "text": {
        "bg": 0,
        "ed": 0,
        "ls": false,
        "pgs": "rpl",
        "rg": [1,6],
        "rst": "rlt",
        "sn": 7,
        "ws": [{"bg": 0,"cw": [{"sc": 0,"w": "深圳"}]},
               {"bg": 0,"cw": [{"sc": 0,"w": "天气"}]},
               {"bg": 0,"cw": [{"sc": 0,"w": "怎么样"}]}
        ]
    }
}

---
2.3.3 WebSocket 二进制数据包 (大端模式)
- 数据包格式
暂时无法在飞书文档外展示此内容
2.3.3.1 V1版本协议
- 解析二进制包，当version=1时使用V1版本协议
- 支持的数据类型如下：
  1：音频帧 2：视频帧
- 音频帧数据字段
暂时无法在飞书文档外展示此内容
- 视频帧数据字段
暂时无法在飞书文档外展示此内容

---
3. demo
3.1 Android demo
- android应用建立连接、解析数据、展现数据demo 
暂时无法在飞书文档外展示此内容
- Demo示例UI效果图
[图片]
3.2 Js Demo
- 代码附件
暂时无法在飞书文档外展示此内容
- Demo示例UI效果图
[图片]


---
4. 工具
4.1 ADB 安装与配置
当瓦力作为 WebSocket 服务端且采用 USB 模式时，客户端 PC 需进行如下操作：
4.1.1 下载安装包
下载adbInstall.zip ，解压至到PC要安装的目录,建议使用全英文路径且目录层级较浅的位置，解下后的文件如下图：
[图片]
4.1.2 安装与配置
执行 setup_adb.bat，自动安装并配置 ADB 环境。
4.1.3 检测adb是否正确安装
按以下步骤检查：
- 打开命令提示符：按 Win + R 键，输入 cmd，然后按 Enter。
- 检查 ADB 版本：在命令提示符中输入以下命令：adb version。
- 查看输出：
  - 如果 ADB 已安装，会显示 ADB 的版本信息：Android Debug Bridge version X.X.X。
  - 如果未安装，系统会提示 'adb' 不是内部或外部命令，也不是可运行的程序或批处理文件。
4.2 端口映射
端口映射adb forward tcp:39999 tcp:39999可在客户端程序连接瓦力前或 PC 启动后执行，通过以下方式实现：可将adb_forward.bat  脚本放入开机自启目录（例如C:\Users\<你的用户名>\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup）。

---
5. 常见问题
如何获取瓦力设备的 IP 地址（当其作为 WebSocket 服务端且非 USB 模式时）
 使用 HDMI 线连接显示器，通过显示器直接查看设备 IP 地址;或者通过小程序的关于本机里查看设备IP。

6. 常见问题
如何获取瓦力设备的 IP 地址（当其作为 WebSocket 服务端且非 USB 模式时）
 使用 HDMI 线连接显示器，通过显示器直接查看设备 IP 地址。

现场没有网络怎么办？
为确保设备联网稳定、运行流畅，建议优先使用 5G通信模块（推荐）。
推荐链接：
铭普 🔗 https://item.jd.com/10103086701799.html
华为：https://item.jd.com/10161093908880.html

如需使用 Wi-Fi 网络，请确保信号稳定可靠（不推荐）：
推荐链接：🔗 【京东】https://3.cn/2f-sfDTh 「翼联无线信号放大器中继器」

多模态参数可以调整吗？
[图片]


## 🛠 硬件规格

分辨率：2160*3840

## 📡 数据协议摘要

*(待补充协议细节)*
